[build]
builder = "nixpacks"

[deploy]
startCommand = "cd backend && npm start"
healthcheckPath = "/api/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"

[[services]]
name = "backend"
source = "backend"

[services.build]
buildCommand = "cd frontend && npm install && npm run build && cd ../backend && npm install"

[services.deploy]
startCommand = "npm start"

[services.variables]
NODE_ENV = "production"
PORT = "$PORT"
